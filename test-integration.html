<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frontend-Backend Integration Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #5a67d8;
        }
        .result {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .error {
            background: #fed7d7;
            border-color: #feb2b2;
            color: #c53030;
        }
        .success {
            background: #c6f6d5;
            border-color: #9ae6b4;
            color: #22543d;
        }
        .loading {
            background: #bee3f8;
            border-color: #90cdf4;
            color: #2a4365;
        }
    </style>
</head>
<body>
    <h1>Frontend-Backend Integration Test</h1>
    
    <div class="test-section">
        <h2>Backend Health Check</h2>
        <button class="test-button" onclick="testHealth()">Test Health Endpoint</button>
        <div id="health-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>Skills API Test</h2>
        <button class="test-button" onclick="testSkills()">Load Skills</button>
        <div id="skills-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>Providers API Test</h2>
        <button class="test-button" onclick="testProviders()">Load Providers</button>
        <div id="providers-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>Authentication Test</h2>
        <button class="test-button" onclick="testSignup()">Test Signup</button>
        <button class="test-button" onclick="testLogin()">Test Login</button>
        <div id="auth-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>UI Integration Test</h2>
        <button class="test-button" onclick="testUI()">Test UI Updates</button>
        <div id="ui-result" class="result"></div>
        <div id="skills-display"></div>
        <div id="providers-display"></div>
    </div>

    <script>
        // API Configuration
        const API_BASE_URL = 'http://localhost:5000/api';
        
        // API Utility Functions
        const api = {
            async get(endpoint) {
                try {
                    const response = await fetch(`${API_BASE_URL}${endpoint}`);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return await response.json();
                } catch (error) {
                    console.error('API GET Error:', error);
                    throw error;
                }
            },

            async post(endpoint, data) {
                try {
                    const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return await response.json();
                } catch (error) {
                    console.error('API POST Error:', error);
                    throw error;
                }
            }
        };

        // Test Functions
        async function testHealth() {
            const resultDiv = document.getElementById('health-result');
            resultDiv.className = 'result loading';
            resultDiv.textContent = 'Testing health endpoint...';
            
            try {
                const result = await api.get('/health');
                resultDiv.className = 'result success';
                resultDiv.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `Error: ${error.message}`;
            }
        }

        async function testSkills() {
            const resultDiv = document.getElementById('skills-result');
            resultDiv.className = 'result loading';
            resultDiv.textContent = 'Loading skills...';
            
            try {
                const result = await api.get('/skills');
                resultDiv.className = 'result success';
                resultDiv.textContent = `Successfully loaded ${result.data.skills.length} skills:\n\n${JSON.stringify(result.data.skills.slice(0, 3), null, 2)}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `Error: ${error.message}`;
            }
        }

        async function testProviders() {
            const resultDiv = document.getElementById('providers-result');
            resultDiv.className = 'result loading';
            resultDiv.textContent = 'Loading providers...';
            
            try {
                const result = await api.get('/users/search/providers');
                resultDiv.className = 'result success';
                resultDiv.textContent = `Successfully loaded ${result.data.users.length} providers:\n\n${JSON.stringify(result.data.users, null, 2)}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `Error: ${error.message}`;
            }
        }

        async function testSignup() {
            const resultDiv = document.getElementById('auth-result');
            resultDiv.className = 'result loading';
            resultDiv.textContent = 'Testing signup...';
            
            try {
                const testUser = {
                    firstName: 'Test',
                    lastName: 'User',
                    email: `test${Date.now()}@example.com`,
                    password: 'TestPassword123!',
                    accountType: 'learner'
                };
                
                const result = await api.post('/auth/signup', testUser);
                resultDiv.className = 'result success';
                resultDiv.textContent = `Signup successful:\n\n${JSON.stringify(result, null, 2)}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `Signup Error: ${error.message}`;
            }
        }

        async function testLogin() {
            const resultDiv = document.getElementById('auth-result');
            resultDiv.className = 'result loading';
            resultDiv.textContent = 'Testing login...';
            
            try {
                const credentials = {
                    email: 'david.chen@example.com',
                    password: 'Password123!'
                };
                
                const result = await api.post('/auth/login', credentials);
                resultDiv.className = 'result success';
                resultDiv.textContent = `Login successful:\n\n${JSON.stringify(result, null, 2)}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `Login Error: ${error.message}`;
            }
        }

        async function testUI() {
            const resultDiv = document.getElementById('ui-result');
            const skillsDisplay = document.getElementById('skills-display');
            const providersDisplay = document.getElementById('providers-display');
            
            resultDiv.className = 'result loading';
            resultDiv.textContent = 'Testing UI integration...';
            
            try {
                // Load and display skills
                const skillsResult = await api.get('/skills');
                const skills = skillsResult.data.skills.slice(0, 3);
                
                skillsDisplay.innerHTML = '<h3>Skills Display:</h3>' + skills.map(skill => `
                    <div style="border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 5px;">
                        <strong>${skill.name}</strong><br>
                        <em>${skill.description}</em><br>
                        Category: ${skill.category}
                    </div>
                `).join('');
                
                // Load and display providers
                const providersResult = await api.get('/users/search/providers');
                const providers = providersResult.data.users;
                
                providersDisplay.innerHTML = '<h3>Providers Display:</h3>' + providers.map(provider => `
                    <div style="border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 5px;">
                        <strong>${provider.firstName} ${provider.lastName}</strong><br>
                        <em>${provider.email}</em><br>
                        Type: ${provider.accountType}
                    </div>
                `).join('');
                
                resultDiv.className = 'result success';
                resultDiv.textContent = `UI integration successful!\nLoaded ${skills.length} skills and ${providers.length} providers.`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `UI Integration Error: ${error.message}`;
            }
        }

        // Auto-run health check on page load
        window.addEventListener('load', testHealth);
    </script>
</body>
</html>
